---
keywords: fastai
title: Simulations
toc: true
badges: true
comments: true
categories: [python]
nb_path: _notebooks/2020-11-03-simulations.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-11-03-simulations.ipynb
-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Simulating-loan-repayments-using-Monte-Carlo-simulation">Simulating loan repayments using Monte Carlo simulation<a class="anchor-link" href="#Simulating-loan-repayments-using-Monte-Carlo-simulation"> </a></h2><p>Entirely based on <a href="https://datascience.quantecon.org/scientific/randomness.html">this</a> excellent QuantEcon tutorial.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A small company makes loans of up to 25k to be repaid a year later. 75 percent of loans are repaid in full, 20 percent of loans are repaid in half, the rest are not repaid. The company discounts the future at an annual rate of 5 percent. How much would the company be willing to loan if it wants to break even on average?</p>
<p>We can calculate this by hand. One year from now, the average repayment is 0.75(25000) + 0.2(12500) + 0.05(0) = 21250. Because that repayment occurs a year from now while the loan is made today, the company calculates the repayment's present value as: (1/1.05)21250 = 20238.1. Assuming that loan repayment is independent of loan size, then this is the loan size for which the company will break even on average (if it makes enough loans).</p>
<p>We can verify this using a simulation:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">repayment_simulator</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">full_repayment</span><span class="o">=</span><span class="mi">25_000</span><span class="p">,</span> <span class="n">partial_repayment</span><span class="o">=</span><span class="mi">12_500</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simulate present value of repayments for N loans.&quot;&quot;&quot;</span>
    <span class="n">repayments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">outcome</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    
    <span class="n">full_repayments</span> <span class="o">=</span> <span class="n">outcome</span> <span class="o">&lt;=</span> <span class="mf">0.75</span>
    <span class="n">repayments</span><span class="p">[</span><span class="n">full_repayments</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_repayment</span>
    <span class="n">partial_repayments</span> <span class="o">=</span> <span class="p">(</span><span class="n">outcome</span> <span class="o">&lt;=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">full_repayments</span>
    <span class="n">repayments</span><span class="p">[</span><span class="n">partial_repayments</span><span class="p">]</span> <span class="o">=</span> <span class="n">partial_repayment</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">))</span> <span class="o">*</span> <span class="n">repayments</span>

<span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">repayment_simulator</span><span class="p">(</span><span class="mi">10_000_000</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>20237.311904761867</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Instead of breaking even, the company is now looking for the largest loan size that will give it a 95 percent chance of being profitable in a year it makes 250 loans.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">simulate_year</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simulate a year with N loans k times.&quot;&quot;&quot;</span>
    <span class="n">year_avgs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="n">year_avgs</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">repayment_simulator</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">year_avgs</span>
    
<span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">simulate_year</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">),</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">95</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([19523.80952381, 20238.0952381 , 20904.76190476])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The result tells us that in 95 percent of simulated years, the average repayment is larger than 19,523. Hence, if the company wants to make a profit with 95 percent probability, it should loan no more than this amount.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Sources">Sources<a class="anchor-link" href="#Sources"> </a></h2><ul>
<li><a href="https://datascience.quantecon.org/scientific/randomness.html">QuantEcon</a></li>
</ul>

</div>
</div>
</div>
</div>
 

